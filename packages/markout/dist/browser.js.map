{"version":3,"file":"browser.js","sources":["../../../markout/lib/entities.js","../../../markout/lib/content/helpers.js","../../../markout/lib/content/dom/normalizer.js","../../../markout/lib/content/dom/renderer.js","../../../markout/lib/content/dom.js","../../../markout/elements/markout-content.js","../../../markout/lib/hashout.js","../../../markout/lib/browser.js"],"sourcesContent":["﻿// import {entities} from '/markup/dist/tokenizer.browser.js';\nimport {entities} from './markup.js';\n\nexport const {\n  UnicodeIdentifier,\n  MarkdownIdentityPrefixer,\n  MarkdownIdentityJoiner,\n  MarkdownIdentityWord,\n  MarkdownIdentity,\n} = (({\n  raw = String.raw,\n  IdentifierStart,\n  IdentifierPart,\n  UnicodeIdentifierStart = IdentifierStart.slice(2),\n  UnicodeIdentifierPart = IdentifierPart.slice(2),\n  UnicodeIdentifier = raw`[\\d${UnicodeIdentifierStart}][\\d${UnicodeIdentifierPart}]*`,\n  MarkdownWordPrefixes = raw`$@`,\n  MarkdownWordPrefix = raw`[${MarkdownWordPrefixes}]?`,\n  MarkdownWord = raw`${MarkdownWordPrefix}${UnicodeIdentifier}`,\n  MarkdownWordJoiners = raw` \\\\\\/:_\\-\\xA0\\u2000-\\u200B\\u202F\\u2060`,\n  MarkdownWordJoiner = raw`[${MarkdownWordJoiners}]+`,\n  // MarkdownIdentity = raw`(?:\\s|\\n|^)(${MarkdownWord}(?:${MarkdownWordJoiner}${MarkdownWord})*(?=\\b[\\s\\n]|$))`,\n  MarkdownIdentity = raw`(?:\\s|\\n|^)(?:The (?=\\w)|)(${MarkdownWord}(?:${MarkdownWordJoiner}${MarkdownWord})*)`,\n}) => ({\n  UnicodeIdentifier: new RegExp(UnicodeIdentifier, 'u'),\n  MarkdownIdentityPrefixer: new RegExp(raw`^[${MarkdownWordPrefixes}]?`, 'u'),\n  MarkdownIdentityJoiner: new RegExp(raw`[${MarkdownWordJoiners}]+`, 'ug'),\n  MarkdownIdentityWord: new RegExp(MarkdownWord, 'u'),\n  MarkdownIdentity: new RegExp(MarkdownIdentity, 'u'),\n  // MarkdownIdentitySeparators: new RegExp(raw`[${MarkdownWordPrefixes}${MarkdownWordJoiners}]+`, 'ug')\n}))(entities.es);\n","﻿//@ts-check\n\n/** @template {selector} T @extends Array<T> */\n//@ts-ignore\nexport class Selectors extends Array {\n  // /**\n  //  * @template {T} U\n  //  * @template This\n  //  * @param {(value: T, index: number, array: T[]) => selector|selectors} callbackFunction\n  //  * @param {This} [thisArgument]\n  //  * @returns {Selectors<T>}\n  //  */\n  //@ts-ignore\n  get flatMap() {\n    Object.defineProperty(\n      Selectors.prototype,\n      'flatMap',\n      Object.getOwnPropertyDescriptor(Array.prototype, 'flatMap') ||\n        Object.getOwnPropertyDescriptor(\n          class extends Array {\n            flatMap(callbackFunction, thisArgument) {\n              return this.concat(...this.map(callbackFunction, thisArgument));\n            }\n          }.prototype,\n          'flatMap',\n        ),\n    );\n\n    return this.flatMap;\n    // return this.concat(...super.map(callbackFunction, thisArgument));\n  }\n\n  toString() {\n    return this.join(',');\n  }\n  static get [Symbol.species]() {\n    return this;\n  }\n}\n\n/** @typedef {string} selector */\n/** @typedef {Selectors|selector[]} selectors */\n","﻿//@ts-check\n// / <reference path=\"../types.d.ts\" />\n\nimport * as entities from '../../entities.js';\nimport {styling} from '../../components.js';\nimport {content} from '../content.js';\nimport {Selectors} from '../helpers.js';\nimport * as defaults from '../defaults.js';\n\n/** @param {Fragment} fragment @param {Record<string, boolean>} [flags] */\nexport const normalizeRenderedFragment = (fragment, flags) => {\n  flags = {\n    DOM_MUTATIONS: fragment.markoutContentFlags.DOM_MUTATIONS = defaults.flags.DOM_MUTATIONS,\n    BREAK_NORMALIZATION: fragment.markoutContentFlags.BREAK_NORMALIZATION = defaults.flags.BREAK_NORMALIZATION,\n    HEADING_NORMALIZATION: fragment.markoutContentFlags.HEADING_NORMALIZATION = defaults.flags.HEADING_NORMALIZATION,\n    PARAGRAPH_NORMALIZATION: fragment.markoutContentFlags.PARAGRAPH_NORMALIZATION = defaults.flags\n      .PARAGRAPH_NORMALIZATION,\n    BLOCK_PARAGRAPH_NORMALIZATION: fragment.markoutContentFlags.BLOCK_PARAGRAPH_NORMALIZATION = defaults.flags\n      .BLOCK_PARAGRAPH_NORMALIZATION,\n    LIST_PARAGRAPH_NORMALIZATION: fragment.markoutContentFlags.LIST_PARAGRAPH_NORMALIZATION = defaults.flags\n      .LIST_PARAGRAPH_NORMALIZATION,\n    CHECKLIST_NORMALIZATION: fragment.markoutContentFlags.CHECKLIST_NORMALIZATION = defaults.flags\n      .CHECKLIST_NORMALIZATION,\n    BLOCKQUOTE_NORMALIZATION: fragment.markoutContentFlags.BLOCKQUOTE_NORMALIZATION = defaults.flags\n      .BLOCKQUOTE_NORMALIZATION,\n    BLOCKQUOTE_HEADING_NORMALIZATION: fragment.markoutContentFlags.BLOCKQUOTE_HEADING_NORMALIZATION = defaults.flags\n      .BLOCKQUOTE_HEADING_NORMALIZATION,\n    TOKEN_FLATTENING: fragment.markoutContentFlags.TOKEN_FLATTENING = defaults.flags.TOKEN_FLATTENING,\n    DECLARATIVE_STYLING: fragment.markoutContentFlags.DECLARATIVE_STYLING = defaults.flags.DECLARATIVE_STYLING,\n    SOURCE_TEXT_RENDERING: fragment.markoutContentFlags.SOURCE_TEXT_RENDERING = defaults.flags.SOURCE_TEXT_RENDERING,\n    ASSET_REMAPPING: fragment.markoutContentFlags.ASSET_REMAPPING = defaults.flags.ASSET_REMAPPING,\n    ASSET_INITIALIZATION: fragment.markoutContentFlags.ASSET_INITIALIZATION = defaults.flags.ASSET_INITIALIZATION,\n  } = {\n    ...defaults.flags,\n    ...(fragment.markoutContentFlags || (fragment.markoutContentFlags = {})),\n    ...flags,\n  };\n\n  flags.DOM_MUTATIONS !== false &&\n    ((flags.BREAK_NORMALIZATION === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeBreaksInFragment(fragment),\n    (flags.HEADING_NORMALIZATION === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeHeadingsInFragment(fragment),\n    (flags.PARAGRAPH_NORMALIZATION === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeParagraphsInFragment(fragment),\n    (flags.BLOCKQUOTE_NORMALIZATION === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeBlockquotesInFragment(fragment),\n    (flags.CHECKLIST_NORMALIZATION === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeChecklistsInFragment(fragment),\n    (flags.DECLARATIVE_STYLING === true || flags.DOM_MUTATIONS === true) &&\n      content.normalizeDeclarativeStylingInFragment(fragment));\n\n  (flags.TOKEN_FLATTENING === true || (flags.TOKEN_FLATTENING !== false && flags.DOM_MUTATIONS !== false)) &&\n    //@ts-ignore\n    content.flattenTokensInFragment(fragment);\n\n  //@ts-ignore\n  content.renderURLExpansionLinksInFragment(fragment);\n};\n\n/** @param {Fragment} fragment */\nexport const normalizeBreaksInFragment = fragment => {\n  for (const br of fragment.querySelectorAll('br')) {\n    const {previousSibling, nextSibling, parentElement} = br;\n    (!previousSibling ||\n      previousSibling.nodeName !== 'SPAN' ||\n      !nextSibling ||\n      nextSibling.nodeName !== 'SPAN' ||\n      (parentElement && !/^(?:CODE|PRE|LI)$/.test(parentElement.nodeName))) &&\n      br.remove();\n  }\n};\n\ncontent.matchers.HeadingNumber = /^[1-9]\\d*\\.$|/;\n\n/** @param {Fragment} fragment */\nexport const normalizeHeadingsInFragment = fragment => {\n  const {MarkdownIdentity: Identity, MarkdownIdentityPrefixer: Prefixer, MarkdownIdentityJoiner: Joiner} = entities;\n  const {headings = (fragment.headings = {}), TEXT_NODE} = fragment;\n\n  for (const subheading of /** @type {Iterable<Heading>} */ (fragment.querySelectorAll(\n    content.selectors.SubheadingsInFragment,\n  ))) {\n    const previousElementSibling = subheading.previousElementSibling;\n    const previousSibling = subheading.previousSibling;\n    if (!previousElementSibling || previousSibling !== previousElementSibling) continue;\n    // console.log({subheading, previousElementSibling, previousSibling});\n    if (previousElementSibling && previousElementSibling.nodeName === 'HGROUP') {\n      previousElementSibling.appendChild(subheading);\n    } else if (previousElementSibling) {\n      const hgroup = document.createElement('hgroup');\n      previousElementSibling.before(hgroup);\n      hgroup.appendChild(previousElementSibling);\n      hgroup.appendChild(subheading);\n    }\n  }\n\n  for (const heading of /** @type {Iterable<Heading>} */ (fragment.querySelectorAll(\n    content.selectors.HeadingsInFragment,\n  ))) {\n    const level = parseFloat(heading.nodeName[1]);\n    const textSpan = heading.querySelector('span[token-type]');\n    const textNode =\n      (textSpan && textSpan.firstChild && textSpan.firstChild.nodeType === TEXT_NODE && textSpan.firstChild) ||\n      undefined;\n\n    const number =\n      textNode &&\n      heading.matches('hgroup > *') &&\n      parseFloat(content.matchers.HeadingNumber.exec(textSpan.textContent)[0]);\n\n    // Assuming all hgroup headings are either intentional or\n    //   implied from markout notation, we want to pull out\n    //   numbering into a data attribute\n    number > 0 && ((heading.dataset.headingNumber = number), textNode.remove());\n\n    // We're limit anchoring from H1 thru H3\n    // if (parseFloat(heading.nodeName[1]) > 3) continue;\n\n    const [, identity] = Identity.exec(heading.textContent) || '';\n    if (!identity) continue;\n    /** @type {Anchor} */\n    const anchor = document.createElement('a');\n    anchor.id = identity\n      .replace(Prefixer, '')\n      .replace(Joiner, '-')\n      .toLowerCase();\n    anchor.append(...heading.childNodes);\n    // anchor.tabIndex = -1;\n    anchor.heading = heading.anchor = {anchor, identity, heading, level, number};\n    heading.appendChild(anchor);\n\n    const nav = anchor.querySelector('nav:last-child');\n    nav && heading.appendChild(nav);\n\n    // Unique mappings are prioritized by heading level\n    (anchor.id in headings && headings[anchor.id].level > level) || (headings[anchor.id] = heading.anchor);\n  }\n};\n\n// const content.matchers.BlockParts = /^(?:(\\w+(?: \\w+)*)(:| - | — |)|)(.*)$/u;\ncontent.matchers.BlockParts = /^[*_]*?(?:(\\*{1,2}|_{1,2}|)(\\w+(?: \\w+)*)\\1(: | - | — |)|)([^]*)$|/u;\n\n/** @param {Fragment} fragment */\ncontent.normalizeBlockquotesInFragment = fragment => {\n  /** @type {BlockQuote} */\n  let previousBlockquote;\n  /** @type {BlockQuote} */\n  let nextBlockquote;\n  /** @type {NodeLike | ElementLike} */\n  let node;\n  /** @type {NodeLike | ElementLike} */\n  let previousNode;\n  /** @type {NodeLike | ElementLike} */\n  let blockNode;\n  /** @type {RangeLike} */\n  let range;\n  let heading, delimiter, headingSeparator, body;\n  const {COMMENT_NODE, TEXT_NODE, ELEMENT_NODE} = fragment;\n\n  for (const blockquote of /** @type {Iterable<BlockQuote>} */ (fragment.querySelectorAll('blockquote:not(:empty)'))) {\n    node = blockquote.querySelector(content.selectors.BlockHeadingNodesInFragment);\n\n    // if (/\\w+:/.test(blockquote.innerText) && node == null) debugger;\n\n    node == null ||\n      (body = blockquote.textContent.trim()) === '' ||\n      ([, delimiter = '', heading = '', headingSeparator = '', body = ''] = content.matchers.BlockParts.exec(body));\n\n    // console.log(`${content.selectors.BlockHeadingNodesInFragment}`, node);\n\n    // console.log(`%o — ${delimiter}%s${delimiter}${headingSeparator}${body}`, {blockquote, node});\n\n    body === '' || (blockquote.blockBody = body);\n\n    if (node != null && heading) {\n      blockquote.blockHeadingNode = /** @type {HTMLSpanElement} */ (node);\n      blockquote.dataset.blockHeading = blockquote.blockHeading = heading;\n      blockquote.dataset.blockHeadingSeparator = blockquote.blockHeadingSeparator = headingSeparator;\n      if ((fragment.markoutContentFlags || defaults).BLOCKQUOTE_HEADING_NORMALIZATION === true) {\n        node.slot = 'block-heading';\n        range = document.createRange();\n        range.setStartAfter(node);\n        previousNode = node;\n\n        while (!(range.text = range.toString()).startsWith(headingSeparator) && (node = node.nextSibling) != null)\n          range.setEndAfter(node);\n\n        node = null;\n        // if (node.nextSibling) do {\n        // \trange.setEndAfter((node = node.nextSibling));\n        // } while (!(range.text = range.toString()).startsWith(headingSeparator) && node.nextSibling != null);\n\n        if (range.text !== headingSeparator) {\n          console.log(\n            `%o — [%s][%s][${body}]`,\n            {blockquote, range, contents: range.contents},\n            previousNode.textContent,\n            range.toString(),\n          );\n        } else {\n          node = document.createElement('span');\n          node.textContent = headingSeparator;\n          node.slot = 'block-heading-separator';\n          range.deleteContents();\n          // previousNode.after(node);\n          blockNode = previousNode.parentElement;\n          while (blockNode.parentElement !== blockquote) blockNode = blockNode.parentElement;\n          blockNode.attachShadow({\n            mode: 'open',\n          }).innerHTML =\n            //\n            /* html */ `\n\t\t\t\t\t\t\t<style>:host {padding: 0.5em;}#contents:slotted(p:first-child) {margin-block-start: 0;-webkit-margin-before:0;}</style>\n\t\t\t\t\t\t\t<div style=\"display: grid; grid-template-columns: var(--block-heading-span, auto) 1fr; grid-gap: 1em;\">\n\t\t\t\t\t\t\t\t<div style=\"text-align:right;\">\n\t\t\t\t\t\t\t\t\t<slot name=\"block-heading\"></slot>\n\t\t\t\t\t\t\t\t\t<slot name=\"block-heading-separator\" hidden></slot>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div><slot id=contents></slot></div>\n\t\t\t\t\t\t\t</div>`;\n          blockNode.remove();\n          blockNode.append(previousNode, node, ...blockquote.childNodes);\n          blockquote.appendChild(blockNode);\n          // blockquote.style.display = 'table-row';\n        }\n      }\n    }\n  }\n\n  // TODO: Figure out why we need all this…\n  for (const lastBlockquote of /** @type {Iterable<BlockQuote>} */ (fragment.querySelectorAll(\n    ':not(blockquote)[blockquote-level]+blockquote[blockquote-level]',\n  ))) {\n    nextBlockquote = lastBlockquote;\n    previousBlockquote = previousNode = undefined;\n    lastBlockquote.blockquoteLevel = parseFloat(lastBlockquote.getAttribute('blockquote-level'));\n\n    node = lastBlockquote.previousSibling;\n\n    if (\n      !(lastBlockquote.blockquoteLevel > 0) ||\n      !(\n        lastBlockquote.previousElementSibling === node ||\n        node.nodeType === COMMENT_NODE ||\n        node.textContent.trim() === ''\n      )\n    ) {\n      content.normalizeBlockquotesInFragment.log({node, lastBlockquote, nextBlockquote, previousBlockquote});\n      continue;\n    }\n\n    while (\n      node != null &&\n      (node.nodeName !== 'BLOCKQUOTE' || !(previousBlockquote = /** @type {BlockQuote } */ (node)))\n    ) {\n      node.blockquoteLevel =\n        node.nodeType === ELEMENT_NODE\n          ? parseFloat(node.getAttribute('blockquote-level'))\n          : nextBlockquote.blockquoteLevel;\n      previousNode = node.previousSibling;\n      if (node.blockquoteLevel === nextBlockquote.blockquoteLevel) {\n      } else if (node.blockquoteLevel > nextBlockquote.blockquoteLevel) {\n        previousBlockquote = nextBlockquote;\n        nextBlockquote = /** @type {BlockQuote } */ (document.createElement('blockquote'));\n        nextBlockquote.setAttribute('blockquote-level', (nextBlockquote.blockquoteLevel = node.blockquoteLevel));\n        previousBlockquote.prepend(nextBlockquote);\n      } else if (node.blockquoteLevel < nextBlockquote.blockquoteLevel) {\n        if (node.blockquoteLevel < lastBlockquote.blockquoteLevel) {\n          // TODO: Is it safer to coerce or superseede?!\n          node.blockquoteLevel = lastBlockquote.blockquoteLevel;\n        }\n        while (\n          nextBlockquote.blockquoteLevel >= lastBlockquote.blockquoteLevel &&\n          node.blockquoteLevel < nextBlockquote.blockquoteLevel &&\n          nextBlockquote.parentElement.blockquoteLevel < nextBlockquote.blockquoteLevel\n        ) {\n          nextBlockquote = nextBlockquote.parentElement;\n        }\n      }\n      nextBlockquote.prepend(node);\n      node = previousNode;\n    }\n\n    if (lastBlockquote.previousSibling === previousNode && previousBlockquote === previousNode) {\n      if (\n        ('blockquoteLevel' in previousBlockquote\n          ? previousBlockquote.blockquoteLevel\n          : (previousBlockquote.blockquoteLevel = parseFloat(previousBlockquote.getAttribute('blockquote-level')))) > 0\n      ) {\n        // TODO: Is it safer to coerce or superseede?!\n        if (previousBlockquote.blockquoteLevel < lastBlockquote.blockquoteLevel) continue;\n\n        if (previousBlockquote.blockquoteLevel === lastBlockquote.blockquoteLevel) {\n          previousBlockquote.childElementCount === 1 && previousBlockquote.firstElementChild.nodeName === 'DETAILS'\n            ? previousBlockquote.firstElementChild.append(...lastBlockquote.childNodes)\n            : previousBlockquote.append(...lastBlockquote.childNodes);\n          lastBlockquote.remove();\n        }\n      } else if (!previousBlockquote.hasAttribute('blockquote-level')) {\n        previousBlockquote.setAttribute(\n          'blockquote-level',\n          `${(previousBlockquote.blockquoteLevel = lastBlockquote.blockquoteLevel)}`,\n        );\n        // TODO: Figure out if we can merge!\n      }\n    }\n  }\n};\n\n/** @param {{node: Node | Element, lastBlockquote: HTMLQuoteElement, nextBlockquote?: HTMLQuoteElement,  previousBlockquote?:HTMLQuoteElement} } nodes */\ncontent.normalizeBlockquotesInFragment.log = nodes => {\n  const format = [];\n  const values = [];\n  for (const name of ['node', 'lastBlockquote', 'nextBlockquote', 'previousBlockquote']) {\n    const node = nodes[name];\n    if (node == null || typeof node !== 'object') continue;\n    format.push('%s [%d] — %O');\n    values.push(name, node.blockquoteLevel || (node.getAttribute && node.getAttribute('blockquote-level')), node);\n  }\n  format.length && console.log(format.join('\\n'), ...values);\n};\n\ncontent.symbols.NormalizedChecklists = Symbol('NormalizedChecklists');\n\n/** @param {Fragment} fragment */\nexport const normalizeChecklistsInFragment = fragment => {\n  const seen =\n    fragment[content.symbols.NormalizedChecklists] || (fragment[content.symbols.NormalizedChecklists] = new WeakSet());\n\n  for (const checklist of fragment.querySelectorAll(\n    'li[type=checkbox]:not([checked]):not([indeterminate]) li[type=checkbox]:not([checked])',\n  )) {\n    let parentChecklist = checklist;\n    // console.log({checklist, parentChecklist});\n    while ((parentChecklist = parentChecklist.parentElement.closest('li[type=checkbox]'))) {\n      seen.has(parentChecklist) ||\n        (seen.add(parentChecklist),\n        parentChecklist.querySelector(':scope li[type=checkbox]:not([checked]):not([indeterminate])')\n          ? parentChecklist.querySelector(':scope  li[type=checkbox][checked]')\n            ? (parentChecklist.removeAttribute('checked'), parentChecklist.setAttribute('indeterminate', ''))\n            : (parentChecklist.removeAttribute('checked'), parentChecklist.removeAttribute('indeterminate'))\n          : !parentChecklist.querySelector(':scope li[type=checkbox][checked]') ||\n            (parentChecklist.removeAttribute('indeterminate'), parentChecklist.setAttribute('checked', '')));\n\n      // if (parentChecklist.hasAttribute('checked') || parentChecklist.hasAttribute('indeterminate')) break;\n      // parentChecklist.setAttribute('indeterminate', '');\n    }\n  }\n};\n\ncontent.normalizeParagraphsInBlock = block => {\n  let element, node, nodes, paragraph, text;\n  node = block.firstChild;\n  if (node == null) return;\n  element = block.firstElementChild;\n  // while (element != null && element.matches('span,code,kbd,tt,small,em,strong,b,i,a,q,wbr,br,slot')) {\n  while (element != null && !element.matches('hr,pre,p,blockquote,table,div')) {\n    element = element.nextElementSibling;\n  }\n  while (node !== element) {\n    (nodes || (nodes = [])).push(node);\n    node = node.nextSibling;\n  }\n  if (nodes) {\n    paragraph = document.createElement('p');\n    paragraph.append(...nodes);\n    text = paragraph.textContent;\n    // console.log({element, node, nodes, paragraph, text});\n    text && text.trim() && block.prepend(paragraph);\n  }\n};\n\n/** @param {Fragment} fragment */\nexport const normalizeParagraphsInFragment = fragment => {\n  if ((fragment.markoutContentFlags || defaults).BLOCK_PARAGRAPH_NORMALIZATION)\n    for (const block of fragment.querySelectorAll('li:not(:empty), blockquote:not(:empty)'))\n      content.normalizeParagraphsInBlock(block);\n  if ((fragment.markoutContentFlags || defaults).LIST_PARAGRAPH_NORMALIZATION)\n    for (const {parentElement: paragraph} of fragment.querySelectorAll(\n      'li > p:first-child:last-child > ol:last-child, li > p:first-child:last-child > ul:last-child',\n    )) {\n      while (\n        paragraph.lastElementChild != null &&\n        (paragraph.lastElementChild.nodeName === 'OL' || paragraph.lastElementChild.nodeName === 'UL') &&\n        (paragraph.lastChild === paragraph.lastElementChild ||\n          paragraph.lastChild.nodeType === paragraph.COMMENT_NODE ||\n          paragraph.lastChild.textContent.trim() === '')\n      ) {\n        paragraph.after(paragraph.lastElementChild);\n      }\n    }\n\n  for (const empty of fragment.querySelectorAll('p:empty')) empty.remove();\n};\n\n/** @param {Fragment} fragment */\nexport const normalizeDeclarativeStylingInFragment = fragment => {\n  styling.apply.toFragment(fragment, normalizeDeclarativeStylingInFragment.defaults);\n};\n\nnormalizeDeclarativeStylingInFragment.defaults = {\n  attributes: {\n    ['--band-fill:'](element, attribute, value, options) {\n      element.style.background = `var(--band-fill${value})`;\n      element.removeAttribute(attribute);\n    },\n  },\n};\n\ncontent.normalizeRenderedFragment = normalizeRenderedFragment;\ncontent.normalizeBreaksInFragment = normalizeBreaksInFragment;\ncontent.normalizeHeadingsInFragment = normalizeHeadingsInFragment;\ncontent.normalizeChecklistsInFragment = normalizeChecklistsInFragment;\ncontent.normalizeParagraphsInFragment = normalizeParagraphsInFragment;\ncontent.normalizeDeclarativeStylingInFragment = normalizeDeclarativeStylingInFragment;\n\ncontent.selectors.HeadingsInFragment = new Selectors(\n  'h1:not([id]):not(:empty)',\n  'h2:not([id]):not(:empty)',\n  'h3:not([id]):not(:empty)',\n  'h4:not([id]):not(:empty)',\n  'h5:not([id]):not(:empty)',\n  'h6:not([id]):not(:empty)',\n);\ncontent.selectors.SubheadingsInFragment = new Selectors('h1+h2', 'h2+h3', 'h3+h4', 'h4+h5', 'h5+h6');\ncontent.selectors.BlockHeadingNodes = new Selectors('i:first-child > b', 'b:first-child > i', 'b', 'i');\n\n// `details:first-child > summary:first-child > ${selector}`,\n// `details:first-child > summary:first-child > p:first-child > ${selector}`,\ncontent.selectors.BlockHeadingNodesInFragment = content.selectors.BlockHeadingNodes.flatMap(selector => [\n  `:scope > ${(selector = `${selector}:first-child:not(:empty)`)}`,\n  `:scope > p:first-child > ${selector}`,\n  // `:scope > p:first-child > p:first-child > ${selector}`,\n]);\n\n/** @typedef {import('../types').Fragment} Fragment */\n/** @typedef {import('../types').Fragment.Heading} Heading */\n/** @typedef {import('../types').Fragment.Headings} Headings */\n/** @typedef {import('../types').Fragment.Anchor} Anchor */\n/** @typedef {import('../types').Fragment.BlockQuote} BlockQuote */\n/** @typedef {Node & {[name: string]: any}} NodeLike */\n/** @typedef {Element & {[name: string]: any}} ElementLike */\n/** @typedef {Range & {[name: string]: any}} RangeLike */\n","﻿//@ts-check\n// / <reference types=\"../\" />\n\nimport * as renderer from '../../renderer.js';\n\nimport * as markup from '../markup.js';\nimport {content} from '../content.js';\n\n/** @param {string} sourceText @returns {Fragment}*/\nexport const createRenderedFragment = sourceText => {\n  /** @type {Fragment} */\n  let fragment, normalizedText, tokens, renderedText;\n\n  content.createRenderedFragment.template ||\n    (content.createRenderedFragment.template = document.createElement('template'));\n\n  content.createRenderedFragment.template.innerHTML = renderedText = renderer.render(\n    (tokens = renderer.tokenize((normalizedText = renderer.normalize(sourceText)))),\n  );\n\n  //@ts-ignore\n  fragment = content.createRenderedFragment.template.content.cloneNode(true);\n  fragment.fragment = fragment;\n  fragment.sourceText = sourceText;\n  fragment.normalizedText = normalizedText;\n  fragment.tokens = tokens;\n  fragment.renderedText = renderedText;\n\n  return fragment;\n};\n\n/** @type {HTMLTemplateElement} */\ncreateRenderedFragment.template = undefined;\n\n/** @param {Fragment} fragment */\nexport const renderURLExpansionLinksInFragment = fragment => {\n  for (const span of fragment.querySelectorAll('span[href]')) {\n    if (span.closest('a')) continue;\n    const anchor = document.createElement('a');\n    anchor.href = span.getAttribute('href');\n    span.before(anchor);\n    anchor.append(...span.childNodes);\n    span.remove();\n  }\n};\n\n/** @param {Fragment} fragment */\nexport const renderSourceTextsInFragment = fragment => {\n  const promises = [];\n\n  for (const element of fragment.querySelectorAll(`[${markup.MarkupAttributeMap.SourceType}]:not(:empty)`))\n    promises.push(\n      markup.renderSourceText({\n        element,\n        sourceType:\n          element.getAttribute(markup.MarkupAttributeMap.MarkupMode) ||\n          element.getAttribute(markup.MarkupAttributeMap.SourceType),\n        sourceText: element.textContent,\n      }),\n    );\n\n  return promises.length ? Promise.all(promises) : Promise.resolve();\n};\n\ncontent.createRenderedFragment = createRenderedFragment;\ncontent.renderURLExpansionLinksInFragment = renderURLExpansionLinksInFragment;\ncontent.renderSourceTextsInFragment = renderSourceTextsInFragment;\n\n/** @typedef {import('../types').Fragment} Fragment */\n","﻿//@ts-check\n/// <reference path=\"./types.d.ts\" />\n\nimport {Enum} from '../helpers.js';\n\nimport './markup.js';\nimport './dom/normalizer.js';\nimport './dom/renderer.js';\n// export * from './dom/normalizer.js';\n// export * from './dom/renderer.js';\nimport {content} from './content.js';\n\n/** @param {Fragment} fragment */\nexport const populateAssetsInFragment = fragment => {\n  if (!fragment || fragment.assets) return;\n  fragment.assets = [];\n\n  for (const link of /** @type {Iterable<Link>} */ (fragment.querySelectorAll(content.AssetNodeSelector))) {\n    if (link.nodeName === 'SCRIPT') {\n      if (link.type === 'module') {\n        (fragment.assets.modules || (fragment.assets.modules = [])).push(/** @type {HTMLScriptElement} */ (link));\n      } else if (!link.type || link.type.trim().toLowerCase() === 'text/javascript') {\n        (fragment.assets.scripts || (fragment.assets.scripts = [])).push(/** @type {HTMLScriptElement} */ (link));\n      }\n    } else if (link.nodeName === 'STYLE') {\n      if (!link.type || link.type.trim().toLowerCase() === 'text/css') {\n        (fragment.assets.stylesheets || (fragment.assets.stylesheets = [])).push(\n          /** @type {HTMLStyleElement} */ (link),\n        );\n      }\n    } else {\n      /** @type {Links} */ (\n        fragment.assets[content.AssetNodeMap[link.nodeName]] ||\n        //@ts-ignore\n        (fragment.assets[content.AssetNodeMap[link.nodeName]] = [])\n      ).push(link);\n    }\n    fragment.assets.push(link);\n  }\n\n  return fragment;\n};\n\n/** @param {Fragment} fragment */\nexport const flattenTokensInFragment = fragment => {\n  for (const token of fragment.querySelectorAll('span[token-type],tt[token-type]')) {\n    token.nodeName === 'TT' || token.before(...token.childNodes);\n    token.remove();\n  }\n};\n\nexport const AssetNodeMap = Enum({\n  IMG: 'images',\n  SOURCE: 'sources',\n  VIDEO: 'videos',\n});\n\nexport const AssetNodeSelector = ['script', 'style', ...Object.keys(AssetNodeMap)]\n  .map(tag => `${tag.toUpperCase()}[src]:not([slot]),${tag.toUpperCase()}[srcset]:not([slot])`)\n  .join(',');\n\ncontent.AssetNodeSelector = AssetNodeSelector;\ncontent.AssetNodeMap = AssetNodeMap;\ncontent.populateAssetsInFragment = populateAssetsInFragment;\ncontent.flattenTokensInFragment = flattenTokensInFragment;\n\n/** @typedef {import('./types').Fragment} Fragment */\n/** @typedef {import('./types').Fragment.Link} Link */\n/** @typedef {import('./types').Fragment.Links} Links */\n","﻿//@ts-check\n\nimport '../lib/content/dom.js';\nimport {content} from '../lib/content.js';\nimport {Component} from '../lib/components.js';\n\nexport class MarkoutContent extends Component {\n  /** @type {{[name: string]: boolean | undefined}} */\n  static get flags() {\n    //@ts-ignore\n    const flags = Object.create(super.flags || null);\n\n    for (const flag in content.defaults.flags) {\n      const value = import.meta[`markout-content-${flag.replace(/-/g, '_').toLowerCase}`];\n      value === undefined || (flags[flag] = value);\n    }\n\n    return super.set('flags', Object.freeze(flags));\n  }\n\n  static get template() {\n    return super.set(\n      'template',\n      this.html/* html */ `\n\t\t\t\t<slot inert hidden style=\"display:none;\"></slot>\n\t\t\t\t<slot id=\"styles\" name=\"styles\"></slot>\n\t\t\t\t<div id=\"links\"></div>\n\t\t\t\t<div id=\"wrapper\">\n\t\t\t\t\t<slot id=\"content\" class=\"markout-content\" name=\"content\"></slot>\n\t\t\t\t</div>\n\t\t\t`,\n    );\n  }\n\n  static get shadowRoot() {\n    return super.set('shadowRoot', /** @type {ShadowRootInit} */ ({mode: 'closed'}));\n  }\n\n  static get assets() {\n    return super.set('assets', new this.Assets({base: new URL('../', import.meta.url)}, 'style:styles/markout.css'));\n  }\n\n  static get styles() {\n    return super.set(\n      'styles',\n      this.css/* css */ `\n\t\t\t\t@import \"${MarkoutContent.assets['style:styles/markout.css']}\";\n\n\t\t\t\t:host {\n\t\t\t\t\tpadding: 1rem 2rem;\n\t\t\t\t\twhite-space: normal;\n\t\t\t\t}\n\n\t\t\t\t.hide {\n\t\t\t\t\topacity: 0;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t}\n\n\t\t\t\t#wrapper {\n\t\t\t\t\t/* will-change: transition;\n\t\t\t\t\ttransition: 0 / 125ms, opacity 250ms / 250ms; */\n\t\t\t\t}\n\n\t\t\t\t#wrapper.hide {\n\t\t\t\t\twill-change: transition;\n\t\t\t\t\ttransition: 0 / 125ms, opacity 250ms / 250ms;\n\t\t\t\t}\n\n\t\t\t\t/* #content:not(.hide) { */\n\t\t\t\t\t/* will-change: transition; */\n\t\t\t\t\t/* transition: opacity 250ms / 250ms; */\n\t\t\t\t/* } */\n\n\t\t\t\t#content tt.opener:first-child,\n\t\t\t\t#content tt.closer:last-child {\n\t\t\t\t\tdisplay: none !important;\n\t\t\t\t}\n\n\t\t\t\t#content .markout-content {\n\t\t\t\t\tborder: 0.075rem solid #9992;\n\t\t\t\t\tborder-radius: 3px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tpadding: 1em 2em;\n\t\t\t\t\tpadding-inline-start: 2em;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tcontain: style;\n\t\t\t\t}\n\n\t\t\t\t@media only screen and (max-width: 45rem) {\n\t\t\t\t\t:host {\n\t\t\t\t\t\tfont-size: 85%;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`,\n    );\n  }\n\n  constructor() {\n    super();\n\n    this.flags = new.target.flags;\n    //@ts-ignore\n    this.name = `${this.tagName}-${++new.target.instance}`.toLocaleLowerCase();\n\n    this.renderedText = /** @type {string} */ (undefined);\n\n    /** @type {HTMLSlotElement} */ const slot = this['::'];\n    slot &&\n      slot.addEventListener(\n        'slotchange',\n        /** @param {Event} event */ event => this.isConnected && this.updateMarkoutContent(slot),\n        {\n          passive: true,\n        },\n      );\n  }\n\n  connectedCallback() {\n    if (this === undefined) this.rendered = this.renderMarkoutContent(this.sourceText);\n    super.connectedCallback();\n  }\n\n  disconnectedCallback() {\n    if (super.disconnectedCallback) super.disconnectedCallback();\n    if (this.untilDisclosed.resolver) this.untilDisclosed.resolver();\n  }\n\n  scrollToAnchor(anchor) {\n    /** @type {HTMLAnchorElement} */\n    let target;\n    //@ts-ignore\n    const {'::content': contentSlot} = this;\n    if (typeof anchor === 'string' && (anchor = anchor.trim()) !== '') {\n      anchor = anchor.toLocaleLowerCase().replace(/^the-/, '');\n      (target = contentSlot.querySelector(`a[id=\"${anchor}\"]`))\n        ? target.scrollIntoView({behavior: 'smooth', block: 'start', inline: 'nearest'})\n        : console.warn('scrollIntoView: %o', {anchor, target});\n    }\n  }\n\n  async updateMarkoutContent(slot = this['::']) {\n    const assignedNodes = slot && slot.assignedNodes();\n    if (assignedNodes.length) {\n      return (this.rendered = this.renderMarkoutContent(this.sourceText || ''));\n    }\n  }\n\n  /** @param {string} [sourceText] */\n  async renderMarkoutContent(sourceText) {\n    /** @type {HTMLSlotElement} */\n    let contentSlot;\n    /** @type {HTMLSlotElement} */\n    let wrapperSlot;\n    /** @type {string} */\n    let sourceURL;\n\n    //@ts-ignore\n    ({'::content': contentSlot, '#wrapper': wrapperSlot, sourceURL} = this);\n\n    arguments.length || (sourceText = this.sourceText);\n\n    if (sourceText === this['(markout source)']) return;\n    this['(markout fragment)'] = undefined;\n    if (!sourceText) return void (this['(markout source)'] = contentSlot.textContent = '');\n\n    wrapperSlot.style.transition = contentSlot.style.transition = '0s';\n    contentSlot.hidden = wrapperSlot.hidden = true;\n    contentSlot.classList.add('hide');\n    wrapperSlot.classList.add('hide');\n\n    await new Promise(resolve => requestAnimationFrame(resolve));\n\n    wrapperSlot.style.transition = contentSlot.style.transition = '';\n    wrapperSlot.classList.remove('hide');\n    wrapperSlot.hidden = false;\n\n    contentSlot.textContent = '';\n\n    this['(markout source)'] = sourceText;\n\n    await this.untilVisible();\n    if (!this.isDisclosed) {\n      this.renderedText = '';\n      return;\n    }\n\n    import.meta['debug:markout-content:rendered-counter'] && console.count('rendered');\n\n    const fragment = (this['(markout fragment)'] = await this.appendMarkoutContent(sourceText, contentSlot, sourceURL));\n\n    // this['(markout source)'] = sourceText;\n\n    const timeout = new Promise(resolve => setTimeout(resolve, 150));\n\n    fragment.assets !== null &&\n      typeof fragment.assets === 'object' &&\n      (fragment.markoutContentFlags.ASSET_INITIALIZATION === true ||\n        (fragment.markoutContentFlags.ASSET_INITIALIZATION !== false &&\n          fragment.markoutContentFlags.DOM_MUTATIONS !== false)) &&\n      (fragment.assets.modules && fragment.assets.modules.forEach(this.instantiateLinkedModule, this),\n      fragment.assets.scripts && fragment.assets.scripts.forEach(this.instantiateLinkedScript, this));\n\n    await Promise.race([MarkoutContent.assets['style:styles/markout.css'], timeout]);\n\n    await timeout;\n\n    contentSlot.classList.remove('hide');\n    contentSlot.hidden = false;\n\n    //@ts-ignore\n    if (this.rewriteAnchors) {\n      const anchors = contentSlot.querySelectorAll('a[href]');\n      //@ts-ignore\n      anchors && this.rewriteAnchors([...anchors]);\n    }\n\n    for (const details of contentSlot.querySelectorAll(\n      `${\n        //@ts-ignore\n        /\\?.*?\\bdetails(?:=open|)\\b/.test(location) ? 'details:not([markout-details=normal]):not([open]),' : ''\n      } details:not(open)[markout-details=open]`,\n    )) {\n      //@ts-ignore\n      details.open = true;\n    }\n  }\n\n  async untilVisible() {\n    return this.untilDisclosed();\n  }\n\n  async untilDisclosed() {\n    let promise, closure, node;\n    if (!this.hasOwnProperty('untilDisclosed')) {\n      Object.defineProperties(this, {\n        untilDisclosed: {value: this.untilDisclosed.bind(this), writable: false},\n      });\n      Object.defineProperties(this.untilDisclosed, {\n        awaiter: {\n          value: (resolver, rejecter) =>\n            void ((this.untilDisclosed.resolver = resolver), (this.untilDisclosed.rejecter = rejecter)),\n          writable: false,\n          configurable: false,\n        },\n        rejecter: {value: undefined, writable: true, configurable: false},\n        resolver: {value: undefined, writable: true, configurable: false},\n        promise: {value: undefined, writable: true, configurable: false},\n      });\n    }\n    node = this;\n    if (this.isConnected) {\n      while (!!node && node !== this.ownerDocument && !(closure = node.closest('details:not([open])'))) {\n        node = node.getRootNode();\n        node.host && (node = node.host);\n      }\n    }\n    promise = this.untilDisclosed.promise;\n    this.isDisclosed = this.isConnected && !closure;\n    if (closure) {\n      if (!promise) {\n        closure.addEventListener('toggle', this.untilDisclosed, {once: true});\n        await (promise = this.untilDisclosed.promise = new Promise(this.untilDisclosed.awaiter));\n        if (this.untilDisclosed.promise === promise) {\n          this.untilDisclosed.resolver = this.untilDisclosed.rejecter = this.untilDisclosed.promise = undefined;\n        }\n      } else {\n        await promise;\n      }\n    } else if (promise) {\n      this.untilDisclosed.resolver();\n      // this.untilDisclosed.resolver = this.untilDisclosed.rejecter = this.untilDisclosed.promise = undefined;\n    }\n    // await promise;\n    return this;\n  }\n\n  /** @param {string} sourceText @param {HTMLSlotElement} contentSlot @param {string} baseURL */\n  async appendMarkoutContent(sourceText = this.sourceText, contentSlot = this['::content'], baseURL = this.baseURI) {\n    const {fragment} = content.createRenderedFragment(sourceText);\n\n    fragment.baseURL = baseURL;\n\n    content.normalizeRenderedFragment(fragment, MarkoutContent.flags);\n\n    contentSlot.appendChild(\n      await (fragment.instantiated || (fragment.instantiated = this.instantiateMarkoutFragment(fragment))),\n    );\n\n    return {slot: contentSlot, sourceText, fragment, ...fragment};\n  }\n\n  async instantiateMarkoutFragment(fragment) {\n    if (fragment.instantiated) return fragment.instantiated;\n\n    const promises = [];\n\n    (fragment.markoutContentFlags.SOURCE_TEXT_RENDERING === true ||\n      (fragment.markoutContentFlags.SOURCE_TEXT_RENDERING !== false &&\n        fragment.markoutContentFlags.DOM_MUTATIONS !== false)) &&\n      promises.push(content.renderSourceTextsInFragment(fragment));\n\n    (fragment.markoutContentFlags.ASSET_REMAPPING === true ||\n      (fragment.markoutContentFlags.ASSET_REMAPPING !== false &&\n        fragment.markoutContentFlags.DOM_MUTATIONS !== false)) &&\n      promises.push(this.linkMarkoutFragment(fragment));\n\n    promises.length && (await Promise.all(promises));\n\n    return fragment;\n  }\n\n  async linkMarkoutFragment(fragment) {\n    if (fragment.instantiated) return fragment.instantiated;\n\n    if (fragment.markoutContentFlags.ASSET_REMAPPING) {\n      content.populateAssetsInFragment(fragment);\n\n      const baseURL = fragment.baseURL || fragment.baseURI;\n\n      for (const link of fragment.assets) {\n        const {base: baseAttribute, [link.nodeName === 'SOURCE' ? 'srcset' : 'src']: srcAttribute} = link.attributes;\n        const base = baseAttribute ? baseAttribute.value : baseURL;\n        baseAttribute && link.removeAttribute('base');\n        link.setAttribute('link-base', base);\n        if (srcAttribute) {\n          const attribute = srcAttribute.name;\n          const [href] = srcAttribute.value.split(/\\s/, 1);\n          link.setAttribute(`link-${attribute}`, href);\n          link.setAttribute(attribute, (link[attribute] = new URL(href, base)));\n        }\n      }\n\n      fragment.assets.stylesheets &&\n        fragment.assets.stylesheets.length &&\n        fragment.prepend(\n          Object.assign(document.createElement('style'), {\n            textContent: fragment.assets.stylesheets\n              .map(stylesheet => (stylesheet.remove(), `@import \"${stylesheet.src}\";`))\n              .join('\\n'),\n          }),\n        );\n    }\n\n    return fragment;\n  }\n\n  /** @param {HTMLScriptElement} module */\n  instantiateLinkedModule(module) {\n    if (module['(markout host)'] === this || !module.isConnected) return;\n    module['(markout host)'] = this;\n    module.before(document.createComment(module.outerHTML.trim()));\n    module.remove();\n    module.src.startsWith(location.origin) &&\n      /\\?.*?\\bdev\\b/i.test(location.href) &&\n      (module.src = module.src.replace(\n        /(\\?[^#]*|)(#.*|)$/,\n        (m, query, hash) => `${query ? `${query}&` : '?'}dev${hash}`,\n      ));\n    // console.log(module, module.src);\n    import(module.src);\n  }\n\n  /** @param {HTMLScriptElement} script */\n  instantiateLinkedScript(script) {\n    if (script['(markout host)'] === this || !script.isConnected) return;\n    if (script.parentElement.nodeName === 'OUTPUT') {\n      script['(markout host)'] = this;\n      this.evaluateMarkoutScript(script);\n    }\n  }\n\n  async evaluateMarkoutScript(script) {\n    const {src} = script;\n    const sourceText = await (await fetch(src)).text();\n    await new Promise(requestAnimationFrame);\n    document['--currentScript--'] = script;\n    (1, eval)(`${sourceText}\\ndelete document['--currentScript--']`);\n  }\n\n  /// Properties\n  get sourceText() {\n    //@ts-ignore\n    const {childNodes, firstElementChild, renderedText} = this;\n    if (renderedText || renderedText === '') return renderedText;\n\n    if (firstElementChild && firstElementChild.nodeName === 'TEMPLATE') return firstElementChild.innerHTML.trim() || '';\n\n    if (childNodes.length) {\n      const innerHTML = this.innerHTML;\n      const [, indent] = /^\\n?([ \\t*]*|)/.exec(innerHTML);\n      return indent ? innerHTML.replace(new RegExp(`^${indent}`, 'mg'), '') : innerHTML.trim() || '';\n    }\n  }\n\n  set sourceText(sourceText) {\n    this.rendered = this.renderMarkoutContent(sourceText);\n  }\n\n  /// Constants\n\n  static get MARKUP_SYNTAX_ATTRIBUTE() {\n    return super.set('MARKUP_SYNTAX_ATTRIBUTE', content.MarkupAttributeMap.MarkupSyntax);\n  }\n  static get SOURCE_TYPE_ATTRIBUTE() {\n    return super.set('SOURCE_TYPE_ATTRIBUTE', content.MarkupAttributeMap.SourceType);\n  }\n  static get MARKUP_MODE_ATTRIBUTE() {\n    return super.set('MARKUP_MODE_ATTRIBUTE', content.MarkupAttributeMap.MarkupMode);\n  }\n}\n\ntry {\n  customElements.define('markout-content', MarkoutContent);\n} catch (exception) {\n  console.warn(exception);\n}\n\n/// Debugging\nimport {debugging} from '/markout/lib/helpers.js';\n\ndebugging('markout-content', import.meta, [\n  typeof location === 'object' && /[?&]debug(?=[&#]|=[^&]*\\bmarkout-content|$)\\b/.test(location.search),\n  'rendered-counter',\n]);\n","﻿/** @param {HTMLAnchorElement} anchor */\nexport const getAliasForAnchor = anchor => {\n  // Abort if no anchor or '(base)' is assigned or null\n  if (!anchor || anchor.nodeName !== 'A' || !anchor.parentElement) return null;\n  if (anchor['(alias)'] !== undefined) return anchor['(alias)'] || null;\n\n  let name = anchor.getAttribute('alias');\n\n  return (anchor['(alias)'] =\n    (name && anchor.getRootNode().querySelector(`a[rel=alias][name=\"${name}\"][ref]`)) || null);\n};\n\n/** @param {HTMLAnchorElement} anchor */\nexport const getBaseForAnchor = anchor => {\n  // Abort if no anchor or '(base)' is assigned or null\n  if (!anchor || anchor.nodeName !== 'A' || !anchor.parentElement) return null;\n  if (anchor['(base)'] !== undefined) return anchor['(base)'] || null;\n\n  return (anchor['(base)'] = anchor.parentElement.querySelector('base[href]') || null);\n};\n\nexport const rewriteAnchors = (\n  anchors,\n  {\n    RewritableURL = rewriteAnchors.defaults.RewritableURL,\n    sourceURL,\n    baseURL,\n    search,\n    rootNode = document,\n    debugging = import.meta['debug:hashout:anchor-rewrite'],\n  },\n) => {\n  debugging && console.groupCollapsed('%O ‹anchors› ', rootNode);\n\n  for (const anchor of anchors) {\n    const href = anchor.getAttribute('href');\n    if (!href) continue;\n    const [matched, parent, name, extension = '.md', query = '', hash = ''] = RewritableURL.exec(\n      href.replace(/%23|%3F/g, decodeURIComponent),\n    );\n\n    // const alias = getAliasForAnchor(anchor);\n    // const baseNode = (alias && getBaseForAnchor(alias)) || getBaseForAnchor(anchor);\n    // const base = (alias && alias.name && /^\\/\\S+\\/$/.test(alias.name) && baseNode && baseNode.href) || sourceURL;\n    const base = sourceURL;\n\n    debugging && console.log({matched, parent, name, extension, query, hash, base});\n\n    if (base !== sourceURL) {\n      anchor.href = new URL(matched, base);\n      anchor.target || (anchor.target = '_blank');\n    } else if (parent || (!!name && matched.startsWith(name))) {\n      const pathname = `${parent || './'}${name ? `${name}${extension}` : ''}`;\n      const href =\n        name && extension.toLowerCase() === '.md'\n          ? `${baseURL}${search}#${new URL(pathname, base).pathname}${hash}`\n          : new URL(`${pathname}${query || (!hash && search) || ''}${hash}`, base);\n      anchor.href = href;\n    } else if (hash) {\n      anchor.href = `${location}${matched}`;\n    } else {\n      anchor.target || (anchor.target = '_blank');\n    }\n\n    // if (debugging && hash) debugger;\n    debugging && console.dirxml(anchor);\n  }\n\n  debugging && console.groupEnd();\n};\n\nrewriteAnchors.defaults = {\n  RewritableURL: /^(\\.*(?=\\/)[^?#\\n]*\\/|)(?:(?:([^/?#\\n]+?)(?:(\\.[a-z]+)|)|)|)(\\?[^#]+|)(#.*|)$|/i,\n};\n\n/// Debugging\nimport {debugging} from '/markout/lib/helpers.js';\n\ndebugging('hashout', import.meta, [\n  // import.meta.url.includes('/markout/lib/') ||\n  typeof location === 'object' && /[?&]debug(?=[&#]|=[^&]*\\bhashout|$)\\b/.test(location.search),\n  'anchor-rewrite',\n]);\n","﻿import '../elements/markout-content.js';\nimport * as hashout from './hashout.js';\n\n(async () => {\n\tawait customElements.whenDefined('markout-content');\n\n\t/** @type {import('../elements/markout-content.js')['MarkoutContent']} */\n\tconst MarkoutContent = customElements.get('markout-content');\n\n\t/**\n\t * @typedef {HTMLAnchorElement} Anchor\n\t */\n\tconst ExtendedMarkoutContent = class extends MarkoutContent {\n\t\tasync load(src) {\n\t\t\tlet error;\n\t\t\targuments.length || (src = this.getAttribute('src'));\n\t\t\tif (!src) return;\n\t\t\tconst url = new URL(src, this.baseURI);\n\t\t\tconst response = await fetch(url);\n\t\t\tif (!response.ok) throw Error(`Failed to fetch ${url}`);\n\t\t\tconst text = await response.text();\n\t\t\tthis.sourceURL = url;\n\t\t\tthis.sourceText = text || '';\n\t\t}\n\n\t\t/**\n\t\t * @typedef {Array<Anchor>} Anchors\n\t\t * @param {Anchors} anchors\n\t\t */\n\t\trewriteAnchors(...anchors) {\n\t\t\tconst debugging = import.meta['debug:markout:anchor-rewrite'];\n\t\t\tconst rootNode = this;\n\t\t\tconst {sourceURL, baseURL = `/markout/`} = rootNode;\n\t\t\tconst search = location.search || '';\n\t\t\thashout.rewriteAnchors([].concat(...anchors), {debugging, sourceURL, baseURL, search, rootNode});\n\t\t}\n\t};\n\n\tconst sections = document.body.querySelectorAll('markout-content[src]');\n\tif (sections) {\n\t\tconst {load, rewriteAnchors} = ExtendedMarkoutContent.prototype;\n\t\tfor (const section of sections) {\n\t\t\tsection.load || ((section.load = load), section.rewriteAnchors || (section.rewriteAnchors = rewriteAnchors)),\n\t\t\t\tsection.load().catch(exception => (section.sourceText = `<pre>${exception}</pre>`));\n\t\t}\n\t}\n})();\n\n/// Debugging\nimport {debugging} from '/markout/lib/helpers.js';\n\n// console.log(import.meta.url, /[?&]debug\\b/.test(import.meta.url));\n\ndebugging('markout', import.meta, [\n\t// import.meta.url.includes('/markout/lib/') ||\n\t// /[?](?:.*[&]|)debug\\b/.test(import.meta.url) ||\n\t// (typeof location === 'object' && /[?&]debug(?=[&#]|=[^&]*\\bmarkout|$)\\b/.test(location.search)),\n\t/[?&]debug\\b/.test(import.meta.url) || /[?&]debug\\b/.test(location.search),\n\t'anchor-rewrite',\n]);\n"],"names":["entities","flags","defaults.flags.DOM_MUTATIONS","defaults.flags.BREAK_NORMALIZATION","defaults.flags.HEADING_NORMALIZATION","defaults.flags\n      .PARAGRAPH_NORMALIZATION","defaults.flags\n      .BLOCK_PARAGRAPH_NORMALIZATION","defaults.flags\n      .LIST_PARAGRAPH_NORMALIZATION","defaults.flags\n      .CHECKLIST_NORMALIZATION","defaults.flags\n      .BLOCKQUOTE_NORMALIZATION","defaults.flags\n      .BLOCKQUOTE_HEADING_NORMALIZATION","defaults.flags.TOKEN_FLATTENING","defaults.flags.DECLARATIVE_STYLING","defaults.flags.SOURCE_TEXT_RENDERING","defaults.flags.ASSET_REMAPPING","defaults.flags.ASSET_INITIALIZATION","defaults.flags","renderer.render","renderer.tokenize","renderer.normalize","markup.MarkupAttributeMap","markup.renderSourceText","hashout.rewriteAnchors"],"mappings":"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"}